#!/bin/sh

# Init
fallbacks_prefix="@abinit_builddir@/fallbacks/install/@abi_fc_vendor@/@abi_fc_version@"

# Find and Unpack tarball 
cd @abinit_builddir@/fallbacks
tarfile=$(ls *.tar.gz)
tar xzf $tarfile
source=${tarfile%.tar.gz}
cd $source

# Configure
./configure \
  --prefix="${fallbacks_prefix}" \
  --with-tardir="${HOME}/.abinit/tarballs" \
  --with-fc-vendor="@abi_fc_vendor@" \
  --with-fc-version="@abi_fc_version@" \
  --with-linalg-libs="@sd_linalg_libs@" \
  --with-linalg-incs="@sd_linalg_fcflags@" \
  --disable-bigdft \
  CC="@CC@" \
  CXX="@CXX@" \
  FC="@FC@"

make -j 8
make install

exit

# Old Configure
./configure \
  --prefix="${fallbacks_prefix}" \
  --srcdir="@abinit_srcdir@/fallbacks" \
  --enable-atompaw="" \
  --enable-bigdft="yes" \
  --enable-libxc="yes" \
  --enable-linalg="yes" \
  --enable-netcdf="yes" \
  --enable-wannier90="yes" \
  --with-tardir="${HOME}/.abinit/tarballs" \
  --with-libxc-incs="@sd_libxc_cppflags@" \
  --with-libxc-libs="@sd_libxc_libs@" \
  --with-linalg-incs="@sd_linalg_fcflags@" \
  --with-linalg-libs="@sd_linalg_libs@" \
  --with-netcdf4-incs="@sd_netcdf_cppflags@" \
  --with-netcdf4-libs="@sd_netcdf_libs@" \
  --with-netcdf4-fortran-incs="@sd_netcdf_fortran_cppflags@" \
  --with-netcdf4-fortran-libs="@sd_netcdf_fortran_libs@" \
  CC="@CC@" \
  CXX="@CXX@" \
  FC="@FC@"
