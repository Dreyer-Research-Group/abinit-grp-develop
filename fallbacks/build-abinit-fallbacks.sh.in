#!/bin/sh

# Init
fallbacks_prefix="@abinit_builddir@/fallbacks/install/@abi_fc_vendor@/@abi_fc_version@"

# Find and Unpack tarball
cd @abinit_builddir@/fallbacks
tarfile=$(ls *.tar.gz)
source=${tarfile%.tar.gz}
if [ ! -d "$source" ]; then
    tar xzf $tarfile
cd $source
make clean

cd $source

# Configure
./configure \
  --prefix="${fallbacks_prefix}" \
  --with-tardir="${HOME}/.abinit/tarballs" \
  --with-linalg-incs="@sd_linalg_fcflags@" \
  --with-linalg-libs="@sd_linalg_libs@" \
  --with-fc-vendor="@abi_fc_vendor@" \
  --with-fc-version="@abi_fc_version@" \
  --disable-hdf5 \
  --disable-bigdft \
  --disable-atompaw \
  --disable-wannier90 \
  --disbale-xmlf90 --disable-libpsml \
  CC="@CC@" \
  CXX="@CXX@" \
  FC="@FC@"

make -j 4 install

exit
