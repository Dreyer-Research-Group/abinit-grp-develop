#!/bin/sh

# Init
fallbacks_prefix="PREFIX"

# Check that the installation prefix has been set
if test "${fallbacks_prefix}" = "PREFIX"; then
  echo "Please edit ${0} and set"
  echo "the 'fallbacks_prefix' variable at the top of the file"
  echo "to the absolute path where you wish to install the fallbacks."
  echo "Then run again this script."
  exit 1
fi

# Configure
@abinit_srcdir@/fallbacks/configure \
  --prefix="${fallbacks_prefix}" \
  --srcdir="@abinit_srcdir@/fallbacks" \
  --enable-atompaw="@abi_atompaw_fbk@" \
  --enable-bigdft="@abi_bigdft_fbk@" \
  --enable-libxc="@abi_libxc_fbk@" \
  --enable-linalg="@abi_linalg_fbk@" \
  --enable-netcdf="@abi_netcdf_fbk@" \
  --enable-wannier90="@abi_wannier90_fbk@" \
  --with-fc-vendor="@abi_fc_vendor@" \
  --with-fc-version="@abi_fc_version@" \
  --with-tardir="${HOME}/.abinit/tarballs" \
  --with-libxc-incs="@afb_libxc_incs@" \
  --with-libxc-libs="@afb_libxc_libs@" \
  --with-linalg-incs="@afb_linalg_incs@" \
  --with-linalg-libs="@afb_linalg_libs@" \
  --with-netcdf-incs="@afb_netcdf_incs@" \
  --with-netcdf-libs="@afb_netcdf_libs@" \
  CC="@CC@" \
  CXX="@CXX@" \
  FC="@FC@"

# Build and install
# Note: 'make -j' might not work, this is why it is disabled
make
make install
