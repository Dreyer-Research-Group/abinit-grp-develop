# GS calculation with the CG + RMM-DIIS eigensolver and NC pseudos
#
rmm_diis  1       # Activate CG + RMM-DIIS.
boxcutmin 1.5

# TODO: Likely bug is use_gemm_nonlop is used in multidataset mode.
#use_gemm_nonlop1 1 # test nonlop with BLAS, requires useylm 1
#useylm1 1
#useylm2 0

ndtset 2

nspinor1 1
nspinor2 2
nspden2  1
getwfk2 -1

ecut   20    # This to overconverge results and make the test more stable.
diemac 12.0

nband  8
toldfe 1e-8

ngkpt   4 4 4
nshiftk 1
shiftk  0.0 0.0 0.0

pp_dirpath "$ABI_PSPDIR"
pseudos "Si_r.psp8"

# Definition of the unit cell
acell 1.0 1.0 1.0
rprim 0.0 5.083880873222 5.083880873222
      5.083880873222 0.0 5.083880873222
      5.083880873222 5.083880873222 0.0

# Definition of the atom types
ntypat 1
znucl 14

natom 2
typat 1 1
xred
      0.0  0.0  0.0
      1/4  1/4  1/4

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% [files]
#%% files_to_test =
#%%   t17.out, tolnlines = 40, tolabs = 3e-04, tolrel = 1.5;
#%% [paral_info]
#%% max_nprocs = 8
#%% [extra_info]
#%% authors = M. Giantomassi
#%% keywords = NC, RMM-DIIS
#%% description = GS calculation with the CG + RMM-DIIS eigensolver and NC pseudos
#%%<END TEST_INFO>
