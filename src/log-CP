57_iovars/m_mpi_setup.F90:   msgttl=trim(msgttl)//'~~~~~~~~~~~'   ! CPUs
61_occeig/m_ebands.F90:! CP modified for occopt 9 
61_occeig/m_ebands.F90:   integer :: ihf = 0 ! CP added for occopt 9 purposes (fermi level of thermalized holes in valence bands)
61_occeig/m_ebands.F90:   real(dp),allocatable :: ghf(:) ! CP added for occopt 9
61_occeig/m_ebands.F90:!!            excited electrons ! CP added
61_occeig/m_ebands.F90:!!                 index ivalence + 1 (below ivalence resp.) ! CP added
61_occeig/m_ebands.F90:! CP modified input list: added ne_qFD, nh_qFD, ivalence.
61_occeig/m_ebands.F90: integer,intent(in) :: bantot,nkpt,nsppol,nspinor,occopt,ivalence ! CP added ivalence
61_occeig/m_ebands.F90: real(dp),intent(in) :: nelect,ne_qFD,nh_qFD,tphysel,tsmear ! CP added ne_qFD,nh_qFD,
61_occeig/m_ebands.F90: ebands%fermih = zero ! CP added
61_occeig/m_ebands.F90: ebands%ivalence =ivalence ! CP added
61_occeig/m_ebands.F90: ebands%ne_qFD   =ne_qFD   ! CP added
61_occeig/m_ebands.F90: ebands%nh_qFD   =nh_qFD   ! CP added
61_occeig/m_ebands.F90:! CP modify
61_occeig/m_ebands.F90: ebands%fermih = hdr%fermih ! CP added
61_occeig/m_ebands.F90: obands%ivalence     = ibands%ivalence ! CP added for occopt 9
61_occeig/m_ebands.F90: obands%fermih  = ibands%fermih ! CP added for occopt 9
61_occeig/m_ebands.F90: obands%ne_qFD  = ibands%ne_qFD ! CP added for occopt 9
61_occeig/m_ebands.F90: obands%nh_qFD  = ibands%nh_qFD ! CP added for occopt 9
61_occeig/m_ebands.F90:   ! CP modified
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90: real(dp) :: entropy,fermie,fermih,stmbias_local,ndiff,cbot,vtop,maxocc ! CP added fermih for occopt 9
61_occeig/m_ebands.F90:   ! CP modified
61_occeig/m_ebands.F90: ! CP added
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90:!!  nelect=New number of electrons ! CP added
61_occeig/m_ebands.F90:!!  nholes=New number of excited holes ! CP added
61_occeig/m_ebands.F90:! CP modified for it to work with occopt 9
61_occeig/m_ebands.F90: real(dp),intent(in) :: nelect,nholes, spinmagntarget ! CP modified
61_occeig/m_ebands.F90: real(dp) :: prev_fermie,prev_fermih,prev_nelect,prev_nholes ! CP modified for occopt 9 case
61_occeig/m_ebands.F90: prev_fermih = ebands%fermie; prev_nelect = zero          ! CP added
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90:! CP modified and added
61_occeig/m_ebands.F90:    prev_fermih = ebands%fermih; prev_nholes = ebands%nh_qFD ! CP added
61_occeig/m_ebands.F90:   ! CP modified
61_occeig/m_ebands.F90: ! CP added for occopt 9 variables
61_occeig/m_ebands.F90: NCF_CHECK(nctk_set_atomic_units(ncid, "holes_fermi_energy")) ! CP modified for occopt == 9
61_occeig/m_ebands.F90: integer :: nw,spin,band,ikpt,ief,ihf,nproc,my_rank,ierr,cnt,bcorr ! CP added ihf for the case occopt 9
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90: ! CP added
61_occeig/m_ebands.F90: edos%ihf = ihf ! CP added
61_occeig/m_ebands.F90:   edos%ghf(spin) = edos%dos(ihf,spin) ! CP added
61_occeig/m_ebands.F90: ABI_SFREE(edos%ghf) ! CP added
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90:   nctkarr_t("edos_ghf", "dp", "nsppol_plus1")  & ! CP added
61_occeig/m_ebands.F90: NCF_CHECK(nf90_put_var(ncid, nctk_idname(ncid, pre("edos_ihf")), edos%ihf)) ! CP added
61_occeig/m_ebands.F90: NCF_CHECK(nf90_put_var(ncid, nctk_idname(ncid, pre("edos_ghf")), edos%ghf)) ! CP added
61_occeig/m_ebands.F90: ! CP added for occopt 9
61_occeig/m_ebands.F90: ! CP modified: added self%ne_qFD, self%nh_qFD, self%ivalence in the list of arguments
61_occeig/m_ebands.F90: new%fermih = self%fermih ! CP added
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90: new%fermih = ebands%fermih ! CP added
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90: integer :: ii, jj, ief, ihf, bmin_, bmax_ ! CP added ihf
61_occeig/m_ebands.F90: ABI_CALLOC(edos%ghf, (0:edos%nsppol)) ! CP added
61_occeig/m_ebands.F90: ! CP modified
61_occeig/m_ebands.F90: ! CP added
61_occeig/m_ebands.F90: edos%ihf = ihf ! CP modified for occopt==9 case
61_occeig/m_ebands.F90:   edos%ghf(spin) = edos%dos(ihf,spin) ! CP modified in case occopt == 9
61_occeig/m_ebands.F90:! CP test to prevent use in case occopt = 9
61_occeig/m_occ.F90:! CP modified to include occopt 9 option
61_occeig/m_occ.F90:!! fermie= fermi energy/ fermi energy for excited electrons if occopt = 9 (Hartree) ! CP description modified
61_occeig/m_occ.F90:!! fermih= fermi energy for excited holes (Hartree) ! CP added
61_occeig/m_occ.F90:          ! CP added fermih, iB1 and iB2 in the list of arguments
61_occeig/m_occ.F90: real(dp),intent(in) :: dosdeltae,fermie,fermih,maxocc,tphysel,tsmear ! CP added fermih
61_occeig/m_occ.F90: integer, intent(in), optional:: iB1, iB2 !! CP: added optional arguments to get number of electrons between bands iB1 and iB2
61_occeig/m_occ.F90: integer :: bantot,iband,iene,ikpt,index,index_tot,index_start,isppol, nene,nptsdiv2 ! CP added index_tot
61_occeig/m_occ.F90: ! CP added: variables
61_occeig/m_occ.F90: ! CP added
61_occeig/m_occ.F90: ! CP delete
61_occeig/m_occ.F90: ! CP modified
61_occeig/m_occ.F90:   ! CP modified for occopt = 9 option, to account for subset of bands bw iB1 and iB2
61_occeig/m_occ.F90:   ! CP modified
61_occeig/m_occ.F90:   ! CP modified
61_occeig/m_occ.F90:   ! CP modified
61_occeig/m_occ.F90:   ! CP modified to fit new argument list of dos_hdr_write
61_occeig/m_occ.F90:     ! CP modified
61_occeig/m_occ.F90:! CP added
61_occeig/m_occ.F90:!!  ne_qFD, nh_qFD=number of thermalized excited electrons (resp. holes) in bands > ivalence (resp. <= ivalence) ! CP added for
61_occeig/m_occ.F90:!!  ivalence= band index of the last valence band ! CP added for occopt 9 case
61_occeig/m_occ.F90:!!  fermih= fermi level for thermalized excited holes in bands <= ivalence ! CP added for occopt 9 case
61_occeig/m_occ.F90:  nelect, ne_qFD, nh_qFD, nkpt, nspinor, nsppol, occ, occopt, prtvol, stmbias, tphysel, tsmear, wtk) ! CP modified: 
61_occeig/m_occ.F90: real(dp),intent(out) :: entropy,fermie,fermih ! CP added fermih
61_occeig/m_occ.F90: ! CP added
61_occeig/m_occ.F90: real(dp) :: dosdeltae,entropy_tmp,fermie_hi,fermie_lo,fermie_mid,fermie_mid_tmp ! CP modified
61_occeig/m_occ.F90: real(dp) :: fermih_lo,fermih_mid,fermih_hi ! CP added
61_occeig/m_occ.F90: real(dp) :: nholeshi,nholeslo,nholesmid ! CP added  
61_occeig/m_occ.F90: real(dp) :: entropyet(2),fermie_hit(2),fermie_lot(2),fermie_midt(2),nelecthit(2) ! CP modified
61_occeig/m_occ.F90: real(dp) :: entropye, entropyh ! CP added
61_occeig/m_occ.F90: if (occopt < 3 .or. occopt > 9) then ! CP modified
61_occeig/m_occ.F90: ! CP added: Check whether the number of holes and electrons if positive
61_occeig/m_occ.F90:! CP added: Providing additional checks to ensure that there are enough valence and conduction bands to accomodate ne_qFD and nh_qFD
61_occeig/m_occ.F90: if (occopt == 3) fermie_lo = fermie_lo - 24.0_dp * tsmear ! CP modified
61_occeig/m_occ.F90: if(occopt==9)fermih_lo = fermie_lo ! CP added to take into account holes
61_occeig/m_occ.F90: ! CP modified
61_occeig/m_occ.F90: ! CP added
61_occeig/m_occ.F90:     fermie_hit(is) = fermie_hi ! CP modified (name only)
61_occeig/m_occ.F90:     fermie_lot(is) = fermie_lo ! CP modified (name only)
61_occeig/m_occ.F90: ! CP modified
61_occeig/m_occ.F90:  ! CP added special test for occopt == 9
61_occeig/m_occ.F90:     fermie_mid = (fermie_hi + fermie_lo) * half ! CP modified (name only)
61_occeig/m_occ.F90:     ! CP modified
61_occeig/m_occ.F90:   fermie = fermie_mid ! CP modified (name only)
61_occeig/m_occ.F90:   entropy= entropye ! CP added (necessary because now we have entropy for the electron and hole subsystems)
61_occeig/m_occ.F90:   ! CP modified
61_occeig/m_occ.F90:      entropy = entropy + entropyh ! CP: adding entropy of the holes subsystem
61_occeig/m_occ.F90:      ! CP added to prevent use with occopt = 9 so far
61_occeig/m_occ.F90:     fermie_biased = fermie - stmbias ! CP modify name
61_occeig/m_occ.F90:     ! CP modify
61_occeig/m_occ.F90:     fermie_hi = fermie_hit(is) ! CP modify name
61_occeig/m_occ.F90:     fermie_lo = fermie_lot(is) ! CP modify name
61_occeig/m_occ.F90:       fermie_mid_tmp=(fermie_hi+fermie_lo)/2.0_dp ! CP modify name
61_occeig/m_occ.F90:       ! CP modify
61_occeig/m_occ.F90:         fermie_hi=fermie_mid_tmp ! CP modify name
61_occeig/m_occ.F90:         fermie_lo=fermie_mid_tmp ! CP modify name
61_occeig/m_occ.F90:     fermie=fermie_mid ! CP modify name
61_occeig/m_occ.F90:     ! CP modify
61_occeig/m_occ.F90:   ! CP modify
61_occeig/m_occ.F90:     ! CP modify
61_occeig/m_occ.F90:     ! CP modify
61_occeig/m_occ.F90:!! fermih= fermi energy of thermalized excited holes when occopt = 9 ! CP added
61_occeig/m_occ.F90:! CP modified arguments list and added fermih
61_occeig/m_occ.F90: ! CP modify
61_occeig/m_occ.F90: ! CP modified
